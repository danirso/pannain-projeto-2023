TITLE - ATIVIDADE - ALUNO: Daniel Scanavini Rossi RA:22000787 | ALUNO: VINICIUS BORGES DE GODOY RA:22006132
.model small
LINHA MACRO
   PUSH AX
   PUSH DX
   MOV DL,10
   MOV AH,02
   INT 21H
   POP DX
   POP AX
ENDM
LIMPA MACRO
   PUSH AX
   MOV AX,03
   INT 10H
   POP AX
ENDM
LIMPA_REG  MACRO
   XOR AX,AX
   XOR BX,BX
   XOR CX,CX
   XOR DX,DX
   XOR SI,SI
ENDM
.stack 100h
.data
PESO1 EQU 3
PESO2 EQU 4
ESCOLHA DB 10 DUP(?)
ALUNOS DB 10 DUP(' '),?,?,?,?
       DB 10 DUP(' '),?,?,?,?
       DB 10 DUP(' '),?,?,?,?
       DB 10 DUP(' '),?,?,?,?
       DB 10 DUP(' '),?,?,?,?

NOME_ALUNO DB'INSIRA O NOME DO ALUNO:$'
P1 DB 10,13,'INSIRA A NOTA DA P1:$'
P2 DB 10,13,'INSIRA A NOTA DA P2:$'
P3 DB 10,13,'INSIRA A NOTA DA P3:$'
PROMPT DB 10,13,'INSIRA O QUE DESEJA REALIZAR',10,13,'1-ALTERAR NOTAS   2-ALTERAR NOME   3-SAIR DO PROGRAMA',10,13,'>$'
CHOICE DB 10,13,'INSIRA O NOME DO ALUNO QUE DESEJA ALTERAR O DADO:$'
NOTA DB 10,13,'INSIRA A NOTA QUE DESEJA ALTERAR',10,13,'1-P1   2-P2   3-P3',10,13,'>$'
NOTA1 DB 10,13,'INSIRA A NOVA NOTA DA PROVA:$'
.code
    MAIN PROC
     LIMPA
     MOV AX,@DATA
     MOV DS,AX
     MOV ES,AX
     MOV CX,2
REPETE:
     PUSH CX
     CALL READ_NAME
     CALL READ_GRADES
     CALL CALC_MEDIA
     LIMPA
     ADD BX,14
     XOR SI,SI
     POP CX
     LOOP REPETE
     LINHA
     CALL IMPRIME_MATRIZ
     CALL MENU
     CMP AL,'3'
     JE FIM
     CMP AL,'1'
     JE ALTERA_NOTA
     ;CALL CHANGE_NAME
     JMP VAI
ALTERA_NOTA:
     CALL CHANGE_GRADES
     CALL CALC_MEDIA
VAI:
     CALL IMPRIME_MATRIZ
FIM:
     MOV AH,4CH  ;FINALIZA O PROGRAMA
     INT 21H
   MAIN ENDP
   ;LE O NOME DOS ALUNOS
   READ_NAME PROC
     LEA DX,NOME_ALUNO
     MOV AH,09
     INT 21H
     XOR SI,SI
     MOV CX,10
     MOV AH,01
LE_NOME:
     INT 21H
     CMP AL,0DH
     JE SEGUE
     MOV ALUNOS[BX][SI],AL
     INC SI
     LOOP LE_NOME
SEGUE:
     RET
   READ_NAME ENDP
   ;LE AS NOTAS DOS ALUNOS
   READ_GRADES PROC
    MOV SI,10
    LEA DX,P1
    MOV AH,09
    INT 21H
    MOV AH,01
    INT 21H
    SUB AL,30H
    MOV ALUNOS[BX][SI],AL
    INC SI 
    
    LEA DX,P2
    MOV AH,09
    INT 21H
    MOV AH,01
    INT 21H
    SUB AL,30H
    MOV ALUNOS[BX][SI],AL
    INC SI 

    LEA DX,P3
    MOV AH,09
    INT 21H
    MOV AH,01
    INT 21H
    SUB AL,30H
    MOV ALUNOS[BX][SI],AL
    RET
   READ_GRADES ENDP
   ;description
   CALC_MEDIA PROC
    XOR AX,AX
    XOR DX,DX
    XOR CX,CX
    MOV SI,10
    MOV AL,ALUNOS[BX][SI]
    MOV DL,PESO1
    MUL DL
    MOV CL,AL
    INC SI

    MOV AL,ALUNOS[BX][SI]
    MOV DL,PESO1
    MUL DL
    ADD CL,AL
    INC SI

    MOV AL,ALUNOS[BX][SI]
    MOV DL,PESO2
    MUL DL
    ADD CL,AL
    XCHG CL,AL
    XOR AH,AH
    MOV CL,10
    DIV CL
    INC SI

    MOV ALUNOS[BX][SI],AL
    RET   
   CALC_MEDIA ENDP
   ;description
IMPRIME_MATRIZ PROC
    LIMPA
    LIMPA_REG
    MOV CX,2
FUNC:    
    PUSH CX
    LINHA
    MOV CX,9
    MOV AH,02
IMP:
    MOV DL,ALUNOS[BX][SI]
    INT 21H
    INC SI
    LOOP IMP
    MOV CX,4;
    INC SI
SEGUIR:
    MOV DL,20H
    INT 21H
    MOV DL,ALUNOS[BX][SI]
    ADD DL,30H
    INT 21H
    INC SI
    LOOP SEGUIR
    ADD BX,14
    XOR SI,SI
    POP CX
    LOOP FUNC
    RET
   IMPRIME_MATRIZ ENDP
   ;description
   MENU PROC
    LIMPA_REG
    MOV AH,09
    LEA DX,PROMPT
    INT 21H
    MOV AH,01
    INT 21H
    RET
   MENU ENDP
   ;description
   CHANGE_GRADES PROC
    LIMPA_REG
    LEA DX,CHOICE
    MOV AH,09
    INT 21H
    CLD
    MOV CX,10
    MOV AH,01
VOLTA:
    INT 21H
    CMP AL,0DH
    JE FIM2
    STOSB 
    LOOP VOLTA
FIM2:
    XOR SI,SI
    MOV CX,5
PROC1:
    PUSH CX
    MOV CX,10
PROCURA:
    LEA DI,ESCOLHA
    REPE CMPSB
    JZ ACHOU
    ADD BX,14
    XOR SI,SI
    POP CX
    LOOP PROC1
ACHOU:
    LEA DX,NOTA
    MOV AH,09
    INT 21H
    MOV AH,01
    INT 21H
    MOV SI,10
    CMP AL,'1'
    JE READ
    CMP AL,'2'
    JE P_2
    ADD SI,3
    JMP READ
P_2:
    ADD SI,2
READ:
    LEA DX,NOTA1
    MOV AH,09
    INT 21H
    MOV AH,01
    INT 21H
    SUB AL,30H
    MOV ALUNOS[BX][SI],AL
    RET
   CHANGE_GRADES ENDP
   END MAIN